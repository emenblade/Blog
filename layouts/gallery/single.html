{{/*
  layouts/gallery/single.html
  ──────────────────────────────────────────────────────────────────────────────
  Gallery post template for hugo-mana-theme.
  Place at: YOUR-SITE-ROOT/layouts/gallery/single.html

  Mirrors the Mana single.html structure exactly:
    single-post-wrapper
      └─ single-post
           ├─ gallery slider   (replaces post-image-single)
           ├─ post-header      (title, description, meta — identical to posts)
           ├─ post-content-main (optional body text below slider)
           ├─ post-footer      (tags)
           └─ post-navigation  (prev/next)
      └─ toc partial (hidden via CSS since no headings — no harm keeping it)

  Images come from page bundle resources — files placed alongside index.md.
  No Hugo image processing (.Fill/.Resize) — avoids Windows file-lock error.
  ──────────────────────────────────────────────────────────────────────────────
*/}}

{{ define "main" }}
<div class="single-post-wrapper">
  <article class="single-post">

    {{/* ── Image Slider (sits where post-image-single normally goes) ───────── */}}
    {{- $images := .Resources.ByType "image" }}
    {{- if $images }}
    <div class="gallery-slider post-image-single" id="gallery-slider"
         aria-label="Photo gallery" role="region">

      {{/* Track — all images in a row, JS slides between them */}}
      <div class="gallery-slider-track" id="gallery-track">
        {{- range $i, $img := $images }}
        {{- $caption := $img.Title | default ($img.Name | strings.TrimSuffix (path.Ext $img.Name)) }}
        <div class="gallery-slide" data-index="{{ $i }}" aria-hidden="{{ if eq $i 0 }}false{{ else }}true{{ end }}">
          <img
            src="{{ $img.RelPermalink }}"
            alt="{{ $caption }}"
            loading="{{ if eq $i 0 }}eager{{ else }}lazy{{ end }}"
          />
          {{- with $img.Title }}
          <div class="gallery-slide-caption">{{ . }}</div>
          {{- end }}
        </div>
        {{- end }}
      </div>

      {{/* Controls — only shown if more than one image */}}
      {{- if gt (len $images) 1 }}
      <button class="gallery-btn gallery-btn-prev" id="gallery-prev" aria-label="Previous photo">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <button class="gallery-btn gallery-btn-next" id="gallery-next" aria-label="Next photo">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
      </button>

      {{/* Dot indicators */}}
      <div class="gallery-dots" id="gallery-dots" role="tablist" aria-label="Photo navigation">
        {{- range $i, $img := $images }}
        <button
          class="gallery-dot{{ if eq $i 0 }} active{{ end }}"
          role="tab"
          aria-selected="{{ if eq $i 0 }}true{{ else }}false{{ end }}"
          aria-label="Photo {{ add $i 1 }} of {{ len $images }}"
          data-index="{{ $i }}"
        ></button>
        {{- end }}
      </div>

      {{/* Counter badge */}}
      <div class="gallery-counter" id="gallery-counter" aria-live="polite">
        <span id="gallery-current">1</span> / {{ len $images }}
      </div>
      {{- end }}

      {{/* Expand-to-lightbox button */}}
      <button class="gallery-expand-btn" id="gallery-expand" aria-label="View fullscreen">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>
      </button>
    </div>
    {{- else }}
    {{/* No images — render nothing in the hero slot */}}
    {{- end }}

    {{/* ── Post Header — identical to Mana's single.html ─────────────────── */}}
    <header class="post-header">
      <h1 class="post-title-main">{{ .Title }}</h1>

      {{ if .Description }}
        <p class="post-description-main">{{ .Description }}</p>
      {{ end }}

      {{ partial "post-meta.html" . }}
    </header>

    {{/* ── Body content (optional text below the slider) ───────────────────── */}}
    {{- with .Content }}
    <div class="post-content-main">
      {{ . }}
    </div>
    {{- end }}

    {{/* ── Tags footer — identical to Mana's single.html ──────────────────── */}}
    {{ if .Params.tags }}
      <footer class="post-footer">
        <div class="post-tags-footer">
          <span class="tags-label">Tags:</span>
          {{ range .Params.tags }}
            <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}" class="post-tag">{{ . }}</a>
          {{ end }}
        </div>
      </footer>
    {{ end }}

    {{/* ── Prev/Next navigation — identical to Mana's single.html ─────────── */}}
    <nav class="post-navigation" aria-label="Post navigation">
      {{ with .PrevInSection }}
        <a href="{{ .RelPermalink }}" class="nav-link nav-prev" aria-label="Previous post: {{ .Title }}">
          <span class="nav-label">Previous</span>
          <span class="nav-title">{{ .Title }}</span>
        </a>
      {{ end }}
      {{ with .NextInSection }}
        <a href="{{ .RelPermalink }}" class="nav-link nav-next" aria-label="Next post: {{ .Title }}">
          <span class="nav-label">Next</span>
          <span class="nav-title">{{ .Title }}</span>
        </a>
      {{ end }}
    </nav>

  </article>

  {{ partial "toc.html" . }}
</div>

{{/* ── Lightbox overlay ─────────────────────────────────────────────────────── */}}
<div id="gallery-lightbox" class="gallery-lightbox" role="dialog" aria-modal="true" aria-label="Full screen photo viewer" hidden>
  <button class="gallery-lightbox-close" id="lb-close" aria-label="Close">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
  </button>
  <button class="gallery-lightbox-prev" id="lb-prev" aria-label="Previous photo">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
  </button>
  <button class="gallery-lightbox-next" id="lb-next" aria-label="Next photo">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
  </button>
  <figure class="gallery-lightbox-figure">
    <img id="lb-img" src="" alt="" />
    <figcaption id="lb-caption" class="gallery-lightbox-caption"></figcaption>
  </figure>
</div>

<script src="/js/gallery.js"></script>
{{ end }}
